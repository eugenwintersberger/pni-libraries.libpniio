

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Spreadsheet like ASCII files &#8212; libpninexus 2.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Reading binary image data" href="image.html" />
    <link rel="prev" title="The low-level ASCII interface" href="ascii_lowlevel.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="image.html" title="Reading binary image data"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ascii_lowlevel.html" title="The low-level ASCII interface"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">libpninexus 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Users guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="legacy.html" >Legacy formats</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="ascii.html" accesskey="U">Reading ASCII data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Spreadsheet like ASCII files</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="spreadsheet-like-ascii-files">
<h1>Spreadsheet like ASCII files<a class="headerlink" href="#spreadsheet-like-ascii-files" title="Permalink to this headline">¶</a></h1>
<p>Many ASCII formats use a speadsheet like scheme to organize their data,
basically storing data in rows and columns. Some formats like SPEC allow
to store multiple runs in a single file (SPEC calls them scans) while others,
like FIO, store only a single run per file and endcode the run number in the
file name.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/data_readers.svg"><img alt="../_images/data_readers.svg" src="../_images/data_readers.svg" width="65%" /></a>
<figcaption>
<p><span class="caption-text">Hierarchy of reader classes in <em>libpninexus</em>.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
<p>Spreadsheet readers favor column based over record based access. Not only
is this the typical way how data is accessed in the field of synchrotron
research, it has also the advantage that the data type is constant within
every column and  thus standard containers can be used.</p>
<p>The <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">spreadsheet_reader</span></code> base class does not support any IO operations
but provides a rather abstract container interface allowing to iterate over
each column. However, instead of the concrete column we can access only
instances of <code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">column_info</span></code> from this interface which.</p>
<p><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">column_info</span></code> provides basic information about each column in the
spreadsheet, namely</p>
<ul class="simple">
<li><p>the <strong>name</strong> of the column</p></li>
<li><p>the <strong>type id</strong> of the cells elementary data type</p></li>
<li><p>the <strong>shape</strong> which is the dimensionality of each cell.</p></li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">print_column_info</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">stream</span><span class="p">,</span><span class="k">const</span> <span class="n">spreadsheet_reader</span> <span class="o">&amp;</span><span class="n">reader</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">info</span><span class="p">:</span> <span class="n">reader</span><span class="p">)</span>
      <span class="n">stream</span><span class="o">&lt;&lt;</span><span class="n">info</span><span class="p">.</span><span class="n">name</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="s">&quot; has type &quot;</span><span class="o">&lt;&lt;</span><span class="n">info</span><span class="p">.</span><span class="n">type_id</span><span class="p">()</span><span class="o">&lt;&lt;</span> <span class="s">&quot; and shape &quot;</span><span class="o">&lt;&lt;</span><span class="n">info</span><span class="p">.</span><span class="n">shape</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more details see the <a class="reference internal" href="../api/ascii_spreadsheet.html#ascii-spreadsheet-api"><span class="std std-ref">ASCII spreadsheet API</span></a>.</p>
<section id="fio-file-support">
<h2>FIO file support<a class="headerlink" href="#fio-file-support" title="Permalink to this headline">¶</a></h2>
<p>FIO is the old file format used at DESY. Every run (sometimes called scan) is
stored in a single file where the run number is encoded in the name of the file.
A FIO file can be roughly divided into three sections</p>
<ul class="simple">
<li><p>a <em>comment</em> section (starting with <code class="docutils literal notranslate"><span class="pre">%c</span></code>) at the very top of the file</p></li>
<li><p>a <em>parameters</em> section (starting with <code class="docutils literal notranslate"><span class="pre">%p</span></code>) storing all kinds of meta-data
and data not altered during the run in a key-value kind fashion</p></li>
<li><p>a <em>data</em> section (starting with <code class="docutils literal notranslate"><span class="pre">%d</span></code>) with a spreadsheet like layout.</p></li>
</ul>
<p>A comment line in FIO starts with a <code class="docutils literal notranslate"><span class="pre">!</span></code>. The <em>data</em> section itself has two
parts</p>
<ul class="simple">
<li><p>a set of <em>column descriptors</em> associating each column with a name and data
type</p></li>
<li><p>the data itself.</p></li>
</ul>
<p>The following snippet shows a shortened example for a FIO file.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>!
! Comments
%c
 EXAFS-Scan started at 1-Feb-2003 20:51:31
 Name: tio2_kronos_0001 from 4750 to 5898.058
 Offsets (already subtracted):
 C1 2193 C2 2495 C3 617 C4 0 C6 0 C7 0 C8 0 C9 0 C11 0 C12 0 C13 0
 C14 0
!
! Parameter
%p
 EXIT_SL_T = -0.35
 ... data omitted ...
 SAMPLE = sample
 IDORIS = 116.04
!
! Data
%d
 Col 1 TIO2_KRONOS_0001  FLOAT
 Col 2 TIO2_KRONOS_0001  FLOAT
 Col 3 TIO2_KRONOS_0001_RING  FLOAT
 Col 4 TIO2_KRONOS_0001_POS_RIN  FLOAT
 Col 5 TIO2_KRONOS_0001_POS_EXP  FLOAT
 Col 6 TIO2_KRONOS_0001_WERT_HHE1  DOUBLE
 Col 7 TIO2_KRONOS_0001_WERT_HHE2  DOUBLE
 ... data omitted ...
 Col 23 TIO2_KRONOS_0001_C13  FLOAT
 Col 24 TIO2_KRONOS_0001_C14  FLOAT
 Col 25 TIO2_KRONOS_0001_STEPS  FLOAT
           4750      5.353544      116.1377  -0.008544922  -0.003662109 7.19041552734375e+01 -7.24616992187500e+01 4.75017769741682e+03 0.00000000000000e+00             5             3             0        426446      2017.667     -40.66667             0             1             0      4.666667      3.333333           169           944      727.6667      803.3333       3091011
           4755      5.343097        116.04  -0.008544922  -0.003662109 7.19314086914062e+01 -7.24616894531250e+01 4.75511986862183e+03 0.00000000000000e+00             5             3             0      426406.3      2038.667     -45.33333             0      6.333333             0      4.666667      3.666667           201           942      695.3333      789.3333       3096532
           4760      5.328669      116.2354  -0.008544922  -0.003662109 7.19584545898438e+01 -7.24616943359375e+01 4.76003483996449e+03 0.00000000000000e+00             5             3             0        426346          2068     -41.66667             0     0.6666667             0      4.666667      4.666667      148.3333           941           727      804.6667       3102040
           4765       5.31495      116.1377  -0.008544922  -0.003662109 7.19854394531250e+01 -7.24616918945313e+01 4.76495268584383e+03 0.00000000000000e+00             5             3             0      426298.3      2096.333     -38.66667             0     0.3333333             0      2.333333      2.666667      156.6667           962      722.3333           835       3107535
           4770      5.302732       116.333  -0.008544922   0.001220703 7.20128271484375e+01 -7.24616845703125e+01 4.76995088467423e+03 0.00000000000000e+00             5             3             0      426277.7          2122     -41.66667             0      3.333333             0             2      7.666667      199.3333      962.6667      739.6667      836.6667       3113017
</pre></div>
</div>
<p>In order to read FIO files use the <a class="reference internal" href="../api/ascii_spreadsheet.html#_CPPv4N3pni10fio_readerE" title="pni::fio_reader"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">pni::fio_reader</span></code></a>.
Opening a FIO file works as with any other reader</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pni</span><span class="o">::</span><span class="n">fio_reader</span> <span class="nf">reader</span><span class="p">(</span><span class="s">&quot;run_000001.fio&quot;</span><span class="p">);</span>
</pre></div>
</div>
<section id="accessing-parameters">
<h3>Accessing parameters<a class="headerlink" href="#accessing-parameters" title="Permalink to this headline">¶</a></h3>
<p>Accessing parameters (stored as key value pairs) is done via the
<code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">parameter()</span></code> template member function. Its template parameter determines
the requested data type for the parameter value</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">pni</span><span class="o">::</span><span class="n">fio_reader</span> <span class="nf">reader</span><span class="p">(</span><span class="s">&quot;run_0000001.fio&quot;</span><span class="p">);</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">reader</span><span class="p">.</span><span class="n">parameter</span><span class="o">&lt;</span><span class="n">pni</span><span class="o">::</span><span class="n">float32</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;IDORIS&quot;</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="accessing-columns">
<h3>Accessing columns<a class="headerlink" href="#accessing-columns" title="Permalink to this headline">¶</a></h3>
<p>Columns are accessed via the <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">column()</span></code> template member function
where the template parameter is typically the container type used to
store the column data</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Float64Column</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">pni</span><span class="o">::</span><span class="n">float64</span><span class="o">&gt;</span><span class="p">;</span>

<span class="n">pni</span><span class="o">::</span><span class="n">fio_reader</span> <span class="nf">reader</span><span class="p">(</span><span class="s">&quot;run_0000001.fio&quot;</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">column</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="n">column</span><span class="o">&lt;</span><span class="n">Float64Column</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;OMEGA&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>the column itself is determined by its name which is passed as the sole
argument to <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">column()</span></code>.</p>
<p>For a full reference of the <a class="reference internal" href="../api/ascii_spreadsheet.html#_CPPv4N3pni10fio_readerE" title="pni::fio_reader"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">pni::fio_reader</span></code></a> see the
<a class="reference internal" href="../api/ascii_spreadsheet.html#ascii-spreadsheet-api"><span class="std std-ref">ASCII spreadsheet API</span></a>.</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Spreadsheet like ASCII files</a><ul>
<li><a class="reference internal" href="#fio-file-support">FIO file support</a><ul>
<li><a class="reference internal" href="#accessing-parameters">Accessing parameters</a></li>
<li><a class="reference internal" href="#accessing-columns">Accessing columns</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ascii_lowlevel.html"
                        title="previous chapter">The low-level ASCII interface</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="image.html"
                        title="next chapter">Reading binary image data</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/users_guide/ascii_spreadsheet.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="image.html" title="Reading binary image data"
             >next</a> |</li>
        <li class="right" >
          <a href="ascii_lowlevel.html" title="The low-level ASCII interface"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">libpninexus 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Users guide</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="legacy.html" >Legacy formats</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="ascii.html" >Reading ASCII data</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Spreadsheet like ASCII files</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Eugen Wintersberger.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.0.3.
    </div>
  </body>
</html>